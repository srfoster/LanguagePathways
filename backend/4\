let {Node,Edge,resolve1,resolveMany,runQuery, binds} = require("./util.js")


class Memory extends Node{
  async link(otherMemory){
    let l = await runQuery("MATCH (m1:Memory),(m2:Memory) WHERE id(m1)=$m1Id AND id(m2)=$m2Id CREATE (m1)-[l:LinksTo]->(m) RETURN h", {id: this.id, mId: m.id})
    return l
  }  
}

class User extends Node{
  async createMemory(props){
    let m = await Memory.create(props) 

    let h = await runQuery("MATCH (m:Memory),(u:User) WHERE id(u)=$id AND id(m)=$mId CREATE (u)-[h:Has {creator: true}]->(m) RETURN h", {id: this.id, mId: m.id})
    

    return m
  } 
 
  async memories(){
    let ms = await resolveMany("MATCH (u:User)-[:Has]->(m:Memory) WHERE id(u) = $id RETURN m", {id: this.id})

    return ms
  }
}


binds({
  Memory,
  User
})

module.exports = {
  Memory,
  User
}
